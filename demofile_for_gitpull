pipeline {
    agent any

    parameters {
        string(name: 'TAG_NAME', defaultValue: '', description: 'Enter the tag name')
        BRANCH_NAME = 'main'
    }

    environment {
        GIT_HOME = "/home/beast9949/git"
        GIT_URL = "https://beast9949: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github.com/beast9949/git_automation.git"
    }

  //  stages {
     //   /*
   //     stage('Checkout') {
   //         steps {
   //             // Checkout the code from your GitHub repository
   //             checkout([$class: 'GitSCM', branches: [[name: '*/main']], userRemoteConfigs: [[url 'https://github.com/beast9949/git_automation.git']]])
     //       }
       // }
    //    */

        stage('Pull and push from GitHub') {
            steps {
                sh '''
                    cd /root/dir1/git_automation
                    git pull origin $BRANCH_NAME
                '''
            }
        }

        stage('Git checkout') {
            steps {
                sh '''
                    cd /root/dir1/git_automation
                    if [ "$BRANCH_NAME" != "main" ]; then
                        git checkout $BRANCH_NAME
                    fi
                '''
            }
        }

        stage('Pull and push from GitHub (Main Branch)') {
            steps {
                sh  '''
                    cd /root/dir1/git_automation
                    git pull origin main
                '''
            }
        }

        stage('Create and push a tag') {
            steps {
                script {
                    def userInput = input(
                        id: 'userInput',
                        message: 'Enter the tag name:',
                        parameters: [string(defaultValue: '', description: 'Tag Name', name: 'TAG_NAME')],
                    )

                    if (userInput.TAG_NAME) {
                        sh "cd /root/dir1/git_automation"
                        sh "git tag -a ${userInput.TAG_NAME} -m 'Version ${userInput.TAG_NAME}'"
                        sh "git push origin --tags"
                    } else {
                        error('Tag name not provided. Tagging aborted.')
                    }
                }
            }
        }

        stage('Pull a tag') {
            steps {
                sh 'git fetch --tags'
                sh "git checkout ${TAG_NAME}"
            }
        }
    }


